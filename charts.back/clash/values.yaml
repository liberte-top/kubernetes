clashApi:
  name: clash-api
  replicas: 2
  image:
    repository: nginx
    tag: alpine
    pullPolicy: Always
  port: 80
  service:
    port: 80
    targetPort: 80
  probes:
    readiness:
      path: /
      initialDelaySeconds: 2
      periodSeconds: 5
    liveness:
      path: /
      initialDelaySeconds: 5
      periodSeconds: 10
  command:
    - /bin/sh
    - -c
  args:
    - |
      cat >/etc/nginx/conf.d/default.conf <<'EOF_NGINX'
      server {
        listen 80;
        location / {
          add_header Content-Type text/plain;
          return 200 "ok\n";
        }
      }
      EOF_NGINX
      nginx -g 'daemon off;'

clashWeb:
  name: clash-web
  replicas: 2
  image:
    repository: nginx
    tag: alpine
    pullPolicy: Always
  port: 80
  service:
    port: 80
    targetPort: 80
  probes:
    readiness:
      path: /
      initialDelaySeconds: 2
      periodSeconds: 5
    liveness:
      path: /
      initialDelaySeconds: 5
      periodSeconds: 10
  command:
    - /bin/sh
    - -c
  args:
    - |
      cat >/etc/nginx/conf.d/default.conf <<'EOF_NGINX'
      server {
        listen 80;
        location / {
          add_header Content-Type text/plain;
          return 200 "ok\n";
        }
      }
      EOF_NGINX
      nginx -g 'daemon off;'

ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  hosts:
    - host: clash.liberte.top
      secretName: clash-tls
      paths:
        - path: /
          serviceName: clash-web
          servicePort: 80
    - host: clash-api.liberte.top
      secretName: clash-api-tls
      paths:
        - path: /
          serviceName: clash-api
          servicePort: 80
    - host: clash-health.liberte.top
      secretName: clash-health-tls
      paths:
        - path: /
          serviceName: clash-api
          servicePort: 80
